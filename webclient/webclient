import bottle
import dbinterface
import Secure

db = dbinterface.DB()

@bottle.route('/hello')
def hello():
    return "Hello World!"

@bottle.route('/')
def loginForm():
    return '''<form method="POST" action="/login">
                <input name="name"     type="text" />
                <input name="password" type="password" />
                <input type="submit" />
              </form>'''


@bottle.post('/login')
def login_submit():
    name     = bottle.request.forms.get('name')
    password = bottle.request.forms.get('password')
    databasePassword = db.grabPW(name)
    if databasePassword == None:
        print("Couldnt find user in DB Named: %s" %name)
    else:
        print("Success!!")
        print(databasePassword)
    if check_login(password, databasePassword):
        return "<p>Your login was correct</p>"
    else:
        return "<p>Login failed</p>"



def check_login(givenPassword, hashedPassword):
    givenPasswordHashed = Secure.SecureIt(givenPassword)
    correctedDBPassword = hashedPassword.replace("-","").lower()

    if givenPasswordHashed == correctedDBPassword:
        return True
    else:
        return False



bottle.run(host='localhost', port=8080)

